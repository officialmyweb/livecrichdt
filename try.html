<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <title>JWPlayer with DASH</title>
    <script src="//ssl.p.jwpcdn.com/player/v/8.25.1/jwplayer.js"></script>
</head>
<style>
    body {
        margin: 0;
        height: 100vh;
    }
    .jwplayer {
        position: absolute !important;
        width: 100%;
        height: 100%;
    }
</style>
<body>

<div id="player"></div>

<script>
    jwplayer.key = 'XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo';

    // Function to decode Base64
    function decodeBase64(base64String) {
        try {
            const binaryString = atob(base64String);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return new TextDecoder("utf-8").decode(bytes);
        } catch (error) {
            console.error("Base64 decoding error:", error);
            return null;
        }
    }

    // Function to setup the JW Player
    function setupPlayer(bearerToken) {
        if (!bearerToken) {
            console.error("Invalid Bearer token");
            return;
        }

        var playerInstance = jwplayer("player");

        // Define the DASH stream source with the Authorization header
        var source = {
            "file": "https://d1yws6emo43ny.cloudfront.net/CH5/masterCH5.mpd",
            "type": "dash",
            "default": true,
            onXhrOpen: function(xhr, url) {
                // Set Authorization header using the decoded Bearer token
                xhr.setRequestHeader('Authorization', 'Bearer ' + bearerToken);
            }
        };

        // Configure DRM clear key
        source.drm = {
            "clearkey": {
                "keyId": "a8eb0f152c6e429ca7a53f399aadf257",
                "key": "c593c2eeea62742285b99e4d87b1c84a"
            }
        };

        // Player setup with the DASH stream source
        playerInstance.setup({
            playlist: [{
                "sources": [source]
            }],
            width: "100%",
            height: "100%",
            aspectratio: "16:9",
            autostart: true,
            cast: {
                appid: 'CC1AD845' // Chromecast support
            }
        });
    }

    // Fetch Base64 data and decode it
    function fetchData() {
        // Example Base64 data from the server
        const base64Data = "gtvlRKWUCOOsTr7mPRpcmg3pqqIH1dMb2Lq9CuBnzNVlZkalEIkJVlD52oMa+RUE+hv4XqFxKk16f/uJYLgWxn6s1MQjYnWDNPteJYxT17GclXDJ6itM3c0XYhxuiGc3dvJhmVquqdQeRJVyn7fZYItn5MtD9lwqiykWQmfvFP+2nVCItaQAnDTzI2OZckrVTZxJ4bhcJaES4C53MvhzJqKw6bOs804eX2TxeEg6OzA1JUrAHEl4XjjYtFB3mCjOQnA8jH2lvny205wCgi2TdUpXPUtYK7HbPsv2ZUNuMRQ4pArbrUuptwWjIDmq8fHjPFWcd1LIQmTO8fjodrXHpykFuOjqIQS6hkc0PYsTRMTRJA4YZhOjeaNJK2Gfb0M+7MKFY4VchKeqiXtQL43l0gKZALghJc3uPwzo146dhsEKI3Ym2qG95fGbiiagYDVUTe/3lwZMj7MSVuYlGHzhXTHx9RcuukMK35PeY9wS/7oLboymHGGTIPY5fdFW4Gseqfz9J5p6/KLu1OJqGDOy7ckVHeWf+1P9qMi9at5gdmDb1Jarrvp6UH/qfSmwguFfd+V36QXeT/phIxj27GY7YPiK1FHpk4bQG3vkMxYDpXWc/rl9mbgU6TWYHGDXk9UEiUcXuLiNtO4rOjqzxwOfOQ==";

        // Decode the Base64 data to get the Bearer token
        const bearerToken = decodeBase64(base64Data);
        console.log("Decoded Bearer Token: ", bearerToken);

        if (bearerToken) {
            setupPlayer(bearerToken);
        } else {
            console.error("Failed to decode the Base64 data.");
        }
    }

    // Call the fetchData function to initiate the request
    fetchData();
</script>

</body>
</html>
